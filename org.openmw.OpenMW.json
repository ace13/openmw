{
  "app-id": "org.openmw.OpenMW",
  "runtime": "org.gnome.Platform",
  "runtime-version": "3.24",
  "sdk": "org.gnome.Sdk",
  "branch": "0.42.0",
  "command": "openmw-launcher",
  "rename-appdata-file": "openmw.appdata.xml",
  "rename-desktop-file": "openmw.desktop",
  "separate-locales": false,
  "finish-args": [
    "--share=ipc", "--socket=x11", "--device=dri",
    "--socket=pulseaudio"
  ],
  "build-options" : {
    "cflags": "-O2 -g",
    "cxxflags": "-O2 -g"
  },
  "cleanup": ["/include", "/lib/pkgconfig",
    "/share/pkgconfig", "/share/aclocal",
    "/man", "/share/man", "/share/gtk-doc",
    "/share/vala",
    "*.la", "*.a"],
    "modules": [
      {
        "name": "libmp3lame",
        "sources": [
          {
            "type": "archive",
            "url": "https://downloads.sourceforge.net/project/lame/lame/3.99/lame-3.99.5.tar.gz?r=https%3A%2F%2Fsourceforge.net%2Fprojects%2Flame%2Ffiles%2Flame%2F3.99%2F&ts=1492375772&use_mirror=kent",
            "sha256": "24346b4158e4af3bd9f2e194bb23eb473c75fb7377011523353196b19b9a23ff"
          }
        ],
        "cleanup": [
          "lame",
          "/include",
          "/lib/*.a",
          "/lib/*.la",
          "/lib/pkgconfig",
          "/man",
          "/share/aclocal",
          "/share/doc",
          "/share/gtk-doc",
          "/share/man",
          "/share/pkgconfig"
        ]
      },
      {
        "name": "ffmpeg",
        "config-opts": [
          "--enable-gpl",
          "--enable-libmp3lame",
          "--enable-libtheora",
          "--enable-libvorbis",
          "--enable-nonfree",
          "--enable-shared",
          "--disable-static",
          "--disable-programs",
          "--disable-doc",
          "--disable-avdevice",
          "--disable-avfilter",
          "--disable-postproc"
        ],
        "sources": [
          {
            "type": "archive",
            "url": "https://ffmpeg.org/releases/ffmpeg-3.2.4.tar.xz",
            "sha256": "6e38ff14f080c98b58cf5967573501b8cb586e3a173b591f3807d8f0660daf7a"
          }
        ],
        "cleanup": [
          "/include",
          "/lib/*.a",
          "/lib/*.la",
          "/lib/pkgconfig",
          "/man",
          "/share/aclocal",
          "/share/doc",
          "/share/gtk-doc",
          "/share/man",
          "/share/pkgconfig"
        ]
      },
      {
        "name": "qt4",
        "config-opts": [
          "-verbose",
          "-confirm-license",
          "-opensource",
          "-release",
          "-shared",
          "-no-static",
          "-fast",
          "-datadir", "/app/lib/qt4",
          "-importdir", "/app/lib/qt4/imports",
          "-plugindir", "/app/lib/qt4/plugins",
          "-translationdir", "/app/share/qt4/translations",
          "-accessibility",
          "-exceptions",
          "-fontconfig",
          "-glib",
          "-dbus-linked",
          "-openssl-linked",
          "-optimized-qmake",
          "-system-libjpeg",
          "-system-libpng",
          "-system-libtiff",
          "-system-proxies",
          "-system-zlib",
          "-no-audio-backend",
          "-no-cups",
          "-no-declarative",
          "-no-declarative-debug",
          "-no-gtkstyle",
          "-no-javascript-jit",
          "-no-libmng",
          "-no-multimedia",
          "-no-nis",
          "-no-openvg",
          "-no-phonon",
          "-no-phonon-backend",
          "-no-qdbus",
          "-no-qt3support",
          "-no-rpath",
          "-no-script",
          "-no-scripttools",
          "-no-sql-db2",
          "-no-sql-ibase",
          "-no-sql-mysql",
          "-no-sql-oci",
          "-no-sql-odbc",
          "-no-sql-psql",
          "-no-sql-sqlite",
          "-no-sql-sqlite2",
          "-no-sql-sqlite_symbian",
          "-no-sql-symsql",
          "-no-sql-tds",
          "-no-svg",
          "-no-webkit",
          "-no-xmlpatterns",
          "-nomake", "demos",
          "-nomake", "docs",
          "-nomake", "examples"
        ],
        "build-options": {
          "env": {
            "CXXFLAGS": "-std=gnu++98",
            "LD_LIBRARY_PATH": "/run/build/qt4/lib/"
          }
        },
        "sources": [
          {
            "type": "archive",
            "url": "https://download.qt.io/official_releases/qt/4.8/4.8.7/qt-everywhere-opensource-src-4.8.7.tar.gz",
            "sha256": "e2882295097e47fe089f8ac741a95fef47e0a73a3f3cdf21b56990638f626ea0"
          }
        ],
        "cleanup": [
          "/bin",
          "/include",
          "/lib/*.a",
          "/lib/*.la",
          "/lib/*.prl",
          "/lib/pkgconfig",
          "/lib/qt4/mkspecs",
          "/lib/qt4/q3porting.xml"
        ]
      },
      {
        "name": "openscenegraph",
        "buildsystem": "cmake",
        "config-opts": [
          "-DBUILD_OSG_PLUGINS_BY_DEFAULT=0",
          "-DBUILD_OSG_PLUGIN_OSG=1",
          "-DBUILD_OSG_PLUGIN_DDS=1",
          "-DBUILD_OSG_PLUGIN_TGA=1",
          "-DBUILD_OSG_PLUGIN_BMP=1",
          "-DBUILD_OSG_PLUGIN_JPEG=1",
          "-DBUILD_OSG_PLUGIN_PNG=1",
          "-DBUILD_OSG_DEPRECATED_SERIALIZERS=0",
          "-DBUILD_OSG_APPLICATIONS=0"
        ],
        "sources": [
          {
            "type": "archive",
            "url": "https://github.com/OpenMW/osg/archive/b6ec7bb7a4cd06ae95bda087d48c0fb7d5ca0abf.zip",
            "sha256": "12c4e2e4f96791751359379365d525717456f3ae435cf1c714b19ebe7775cf06"
          }
        ],
        "cleanup": [
          "/include",
          "/lib/*.a",
          "/lib/*.la",
          "/lib/pkgconfig"
        ]
      },
      {
        "name": "bullet",
        "buildsystem": "cmake",
        "config-opts": [
          "-DBUILD_BULLET2_DEMOS=0",
          "-DBUILD_BULLET3=0",
          "-DBUILD_CPU_DEMOS=0",
          "-DBUILD_EXTRAS=0",
          "-DBUILD_OPENGL3_DEMOS=0",
          "-DBUILD_UNIT_TESTS=0",
          "-DUSE_GLUT=0",
          "-DUSE_GRAPHICAL_BENCHMARK=0"
        ],
        "sources": [
          {
            "type": "archive",
            "url": "https://github.com/bulletphysics/bullet3/archive/2.86.1.tar.gz",
            "sha256": "c058b2e4321ba6adaa656976c1a138c07b18fc03b29f5b82880d5d8228fbf059"
          }
        ],
        "cleanup": [
          "/include",
          "/lib/*.a",
          "/lib/*.la",
          "/lib/pkgconfig"
        ]
      },
      {
        "name": "mygui",
        "buildsystem": "cmake",
        "config-opts": [
          "-DMYGUI_RENDERSYSTEM=1",
          "-DMYGUI_BUILD_DEMOS=0",
          "-DMYGUI_BUILD_TOOLS=0",
          "-DMYGUI_BUILD_PLUGINS=0"
        ],
        "sources": [
          {
            "type": "archive",
            "url": "https://github.com/MyGUI/mygui/archive/MyGUI3.2.2.tar.gz",
            "sha256": "0a28d7ec8a47993cb68deb48b36331e28f12dd92580b709eaef21d599b67a78f"
          }
        ],
        "cleanup": [
          "/include",
          "/lib/*.a",
          "/lib/*.la",
          "/lib/pkgconfig"
        ]
      },
      {
        "name": "libunshield",
        "buildsystem": "cmake",
        "sources": [
          {
            "type": "archive",
            "url": "https://github.com/twogood/unshield/archive/1.4.2.tar.gz",
            "sha256": "5dd4ea0c7e97ad8e3677ff3a254b116df08a5d041c2df8859aad5c4f88d1f774"
          }
        ],
        "cleanup": [
          "/include",
          "/lib/*.a",
          "/lib/*.la",
          "/lib/pkgconfig"
        ]
      },
      {
        "name": "boost",
        "sources": [
          {
            "type": "archive",
            "url": "https://downloads.sourceforge.net/project/boost/boost/1.64.0/boost_1_64_0.tar.bz2",
            "sha256": "7bcc5caace97baa948931d712ea5f37038dbb1c5d89b43ad4def4ed7cb683332"
          },
          {
            "type": "script",
            "commands": [
              "./bootstrap.sh \"$@\"",
              "cat <<EOF >Makefile",
              "all:",
              "\t./b2 -j `nproc` ./b2 stage threading=multi link=shared",
              "",
              "install:",
              "\t./b2 install",
              "EOF"
            ],
            "dest-filename": "configure"
          }
        ],
        "cleanup": [
          "/include",
          "/lib/*.a",
          "/lib/*.la",
          "/lib/pkgconfig"
        ]
      },
      {
        "name": "openmw",
        "builddir": true,
        "buildsystem": "cmake",
        "config-opts": [
          "-DBUILD_BSATOOL=no",
          "-DBUILD_ESMTOOL=no",
          "-DBUILD_MYGUI_PLUGIN=no",
          "-DBUILD_OPENCS=no"
        ],
        "sources" : [
          {
            "type": "git",
            "url": "git://github.com/OpenMW/openmw.git",
            "branch": "openmw-0.42.0"
          },
          {
            "type": "shell",
            "commands": [
              "sed -i s:Icon=openmw:Icon=org.openmw.OpenMW: files/openmw.desktop"
            ]
          }
        ],
        "post-install": [
          "mkdir -p /app/share/icons",
          "cp /app/share/pixmaps/openmw.png /app/share/icons/org.openmw.OpenMW.png"
        ]
      }
    ]
}
